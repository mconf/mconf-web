-# Locals:
-#   space (Space): the target model
-#   is_member (boolean): Whether the current user is a member of the space or not
-#   extended (boolean): show extended information
-#   show_join_request (boolean): show link to a join request (if it exists)

- extended ||= false
- show_join_request ||= false

- unless space.nil?
  = content_tag(:div, :name => space.permalink, :class => "thread space-container thread-space #{cycle("thread-even" , "thread-odd")} space-item") do
    .logo-in-thread
      = link_logo_image(space, :size => '84x64', :"data-placement" => 'bottom', :class => "logo logo-space")

    .thread-content
      .col-xs-12.col-sm-8.thread-title
        %span
          = link_to space_path(space) do
            = Mconf::Highlighter.highlight(space.name, params[:q].try(:split))
        .space-description
          - if space.public
            .resource-visibility.small.public
              = icon_space_public
              = t(".public")
              = t('.with_members', :count => space.users.size)
          - else
            .resource-visibility.small.private
              = icon_space_private
              = t(".private")
              = t('.with_members', :count => space.users.size)
          - if extended && is_member
            .resource-visibility.small
              = icon_is_member
              = t(".is_member")

          - if current_site.require_space_approval? && !space.approved?
            .space-waiting-moderation.resource-visibility.small
              = icon_waiting_moderation
              = t("_other.not_approved.text")

      .col-xs-12.col-sm-4.thread-description
        - if extended
          = Mconf::Highlighter.highlight(sanitize(space.description), params[:q].try(:split))

        .show-join-request
          - if show_join_request
            - jr = space.pending_join_request_or_invitation_for(current_user)
            - if jr
              = icon_join_request
              - if jr.is_invite?
                = link_to t(".reply_invitation"), space_join_request_path(space, jr)
              - else
                = link_to t(".view_join_request"), space_join_request_path(space, jr)

      = render :partial => "spaces/space_tags", :locals => { :space => space }
